## 准备数据以及表脚本
* 数据表
    ```
    CREATE TABLE `t` (
        `a` int NOT NULL,
        `b` varchar(8000) DEFAULT NULL,
        `c` int NOT NULL,
        PRIMARY KEY (`a`),
        KEY `idx_c` (`c`)
        ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
    ```
 * SQL脚本
    ```
        insert into t select 1,REPEAT('a',7000),-1; //插入7000长度字符记录是保证一页最多存储两条记录
        insert into t select 2,REPEAT('a',7000),-2; 
        insert into t select 3,REPEAT('a',7000),-3;
        insert into t select 4,REPEAT('a',7000),-4;
    ```
* 在gitHub上克隆一个 py_innodb_page_info.py 的仓库
  * [仓库地址](git@github.com:tianyk/py_innodb_page_info.git "仓库地址")

## 解析索引页数据
* 在MySQL数据存储目录下存在一个 `t.ibd` 文件,通过 `py_innodb_page_info.py` 解析其页信息.
  * 得到索引页的存储信息为 `page offset 00000004, page type <B-tree Node>, page level <0001>`
    * `page level` 位置在 `0x10040`地址,两字节值为 `0x0001`,表明该页为`索引页`.
* 通过 `hexdump -C -v -s 65536 -n 16384 t.ibd > indexNode.hex` 命令转储文件内容.
  * 打开 `indexNode.hex` 文件,该文件存储的便是该索引页的内容.
* 通过 `Page Directory` 来解析该页数据. `Page Directory` 就只有两个条目,其值为 `0x0070`,`0x0063`.
  * `0x0063` 即 `0x10000`(`该页的起始偏移地址`),`0x10063`即 `infimum` 记录的数据列位置.
    * 其 `Recorder Header` 最后两个字节为 `0x001b`.即下一条记录位置为 `0x10063 + 0x001b=0x1007e`
    * 跳到 `0x1007e`位置,其附近字节数据为.
      ```
        00010078-00010085 00 10 00 11 00 0e 80 00 00 01 00 00 00 06
        00010086-00010093 00 00 00 19 00 0e 80 00 00 02 00 00 00 07
        00010094-000100a1 00 00 00 21 ff d6 80 00 00 04 00 00 00 08
      ```
        * 由于每一条记录的开始位置是到列的位置,并不是记录的头信息开始.故 `0x0001007e` 之前6字节是头部信息.
          * 其中`Recorder Header`固定5字节.之前还有一个字节是 `NULL标志位`,因为表中`存在可以为NULL的字段b`,故需要一字节的位图.
        * `0x0001007e`后开始是有8字节
          * 前4字节为 `0x80000001`,表示`当前数据id为1的数据`.
          * 后四字节为 `0x00000006`,表示`id数据为1的记录存储在偏移为6的数据页中`.
* 数据页存放的是完整的每行的记录,在非数据页的索引页中,存放的仅仅是键值以及指向`数据页`的偏移量,而不是一个完整行记录.
* `Secondary Index` 辅助索引页.
  * 该页偏移位置 `0x14038-0x1403f` 定义了 `0x0000000000002f6b` 数据,该位置`只会在辅助索引页中定义`.
  * 除去两条伪行记录的数据,数据的内容为
    ```
      0x00014078-0x00014084 00 00 10 ff f3 7f ff ff ff 80 00 00 01
      0x00014085-0x00014091 00 00 18 ff f3 7f ff ff fe 80 00 00 02
      0x00014092-0x0001409d 00 00 20 ff f3 7f ff ff fd 80 00 00 03
      0x0001409f-0x000140ab 00 00 28 ff f3 7f ff ff fc 80 00 00 04
    ```
  * 辅助索引的叶子节点中`包含了对应的列值与主键的值`.
  * 辅助索引都是通过其索引字段检索到主键,再通过主键去查找记录.

