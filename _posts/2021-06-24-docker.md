## Docker
### 安装docker
1. 添加docker的软件源信息
    ```
        yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
    ```
2. 安装docker
    ```
        yum install docker-ce docker-ce-cli containerd.io
    ```
3. 开启docker服务(开启开机自启)
    ```
        system enable docker && systemctl start docker
    ```
4. 添加一个非root用户管理docker,由于其会创建一个可由docker组成员访问的Unix Socket,即只要创建对应的组即可
    ```
        groupadd docker
    ```
5. 将对应的用户添加到该组下
    ```
        usermod -aG docker carllongj
    ```
#### 开启docker服务
* 开启此服务可以通过 `TCP连接` 来管理docker容器和镜像
* 编辑启动服务文件,路径为 `/lib/systemd/system/docker.service`.
    * 编辑对应行 `ExecStart` 对应的配置行,添加tcp监听服务.
        * `-H tcp://0.0.0.0:23456`,监听对应的端口
* 执行重新加载
    * `systemctl daemon-reload`.
* 重新启动docker
    * `systemctl restart docker`.

### docker的命令
* 容器类 
    * `docker container [command] [options] ` 来执行容器类的管理命令,`大部分情况下,container 可以省略`,如`docker container ps` 可以使用 `docker ps`替代.
        * docker ps                                             : 列出正在运行的容器信息
        * docker ps -a                                          : 列出所有的容器信息
        * docker start `<container>`                            : 启动一个已停止的容器
        * docker stop `<container>`                             : 停止一个正在运行的容器
        * docker restart `<container>`                          : 重启容器
        * docker rm -f `<container>`                            : 删除容器
        * docker container prune `<container>`                  : 删除所有终止状态的容器(`不可省略`)
        * docker container exec `<container>` `<cmd>`           : 在运行中的指定容器中,执行指定命令.
        * docker container top `<container>`                    : 展示运行中的指定容器的运行进程.
    * 容器类的唯一标识为 `container_id` 或者通过 `-name` 设置的名称,通过`docker ps 命令可以拿到`
* 运行类
    * `docker run [options] <image> [command] [args]` 用来使用一个镜像来启动容器.
        * options说明
            * `-i`                                              : 交互式操作
            * `-t`                                              : 打开一个终端
            * `-d`                                              : 将容器运行在后台(`不会进入容器`)
            * `-name`                                           : 指定容器的名称(后续的操作也可以使用名称来映射容器)
            * `-p`                                              : 设置容器的端口号到主机的端口号映射,格式为 `host_port:container_port`
            * `-P`                                              : 指定容器所有的端口映射为主机随机高端口
            * `-e`                                              : 设置环境变量
    * `docker exec [options] <container> [command] [agrs]` 连接到容器
        * options 说明
            * `-i`                                              : 交互式操作
            * `-t`                                              : 打开一个终端
        * 在正在运行的容器中运行命令,`一般用于使用了 -d 启动的容器`.
* 镜像类
    * 镜像是通过镜像名称来识别.
        * docker images                                         : 列出本地主机上的所有镜像
        * docker pull `<image>:<tag>`                           : 获取一个新的镜像,`image表示镜像名称`,`tag表示镜像版本`
        * docker search `<image>`                               : 查询指定名称的镜像,进行匹配.若`未指定tag`,则使用默认的`latest`
            * 结果显示列说明,`OFFCIAL`, 是否 `docker` 官方发布.
        * docker rmi `<image>`                                  : 删除指定名称的镜像.
    * 创建镜像
        * 从已经创建的容器中更新镜像,并且提交这个镜像.
        * 使用Dockerfile指令来创建一个新的镜像
            * `docker build [options] PATH|URL`
                * `PATH|URL`表示指定的`Dockerfile`所在的路径
                * options说明
                    * `-t`                                      : 给当前的镜像设置一个标签
### Dockerfile指令
* Dockerfile 用于构建镜像的指令脚本
* 在 Dockerfile 中,`#` 开头的内容表示注释
* 关键字

|   指令                   |   说明                                                                         |
|:------------------------:|:-----------------------------------------------------------------------------:|
| FROM `image`             | 指定新镜像所基于的镜像,第一条指令必须为FROM指令,每创建一个镜像就需要一条FROM指令    | 
| MAINTAINER `name`        | 说明镜像的维护人信息                                                            |
| RUN `cmd`                | 在所基于的镜像上执行命令,并提交到新的镜像上,在构建时执行                           |
| CMD `["sh","p1","p2"]`   | 指定启动容器时要运行的命令,Dockerfile只能有一条CMD命令,如果有多条也只执行最后一条   |
| EXPOST `port`            | 指定新镜像加载到Docker时要开启的端口                                             |
| ENV `KEY` `VALUE`        | 设置一个环境变量的值,会被后面的`RUN`使用                                         |
| ADD `f|d` `f|d`          | 将源文件或目录复制到目标文件,源文件要与Dockerfile位于相同目录,也可以是一个URL源文件 |
| COPY `f|d` `f|d`         | 将本地主机上的文件复制到目标目录,源文件与Dockerfile位于相同目录                    |
| VOLUMN `["/d"]`          | 在容器中创建一个挂载点                                                          |
| USER `uname|uid`         | 指定运行容器时的用户                                                            |
| WORKDIR `/d`             | 为后续的`RUN`,`CMD`,`ENTRYPOINT`指定工作目录                                    |
| ONBUILD `cmd`            | 指定所生成的镜像作为一个基础镜像时需要运行的命令                                  |
| HEALTHCHECK              | 健康检查                                                                       | 

### 通过 docker 安装软件
#### 安装MySQL
```
    1. 下载镜像(安装指定版本的MySQL)
    docker pull mysql:5.7

    2. 启动容器 
    docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql
    
    3. 进入容器
    docker exec -it mysql /bin/bash

    4. 其余的操作跟在MySQL客户端操作一致
```
### Q & A
* Q: 执行 `yum-config-manager` 命令未找到. 
    * A: 安装 `yum-utils`, 执行 `yum install -y yum-utils`.